<!DOCTYPE html><html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D"><head>
    <title>@luxdamore/nuxt-prune-html</title><meta data-hid="description" name="description" content="Nuxt module to prune html before sending it to the browser (it removes elements matching CSS selector(s)), useful for boosting performance showing a different HTML for bots by removing all the scripts with dynamic rendering"><base href="/nuxt-prune-html/"><style data-vue-ssr-id="7372a3d1:0 0efaf680:0 3b37a659:0 124e288c:0">/*! modern-normalize v0.6.0 | MIT License | https://github.com/sindresorhus/modern-normalize */*,:after,:before{box-sizing:border-box}:root{-moz-tab-size:4;-o-tab-size:4;tab-size:4}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji}hr{height:0}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{padding:0}progress{vertical-align:baseline}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}:root{font-size:16px}body{line-height:1.5;color:#333}.container{max-width:1366px;padding:16px;margin:0 auto}h1{font-size:2em}blockquote{padding:0 1rem;margin-left:0;color:#819198;border-left:.3rem solid #dce6f0}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><main class="container readme"><article class="markdown-body"><section><h1>&#x1F389; Nuxt Prune HTML</h1>
<p><a href="https://npmjs.com/package/@luxdamore/nuxt-prune-html"><img src="https://img.shields.io/npm/v/@luxdamore/nuxt-prune-html/latest.svg?style=flat-square" alt="npm version"></a>
<a href="https://npmjs.com/package/@luxdamore/nuxt-prune-html"><img src="https://img.shields.io/npm/dt/@luxdamore/nuxt-prune-html.svg?style=flat-square" alt="npm downloads"></a>
<a href="https://circleci.com/gh/LuXDAmore/nuxt-prune-html"><img src="https://img.shields.io/circleci/project/github/LuXDAmore/nuxt-prune-html.svg?style=flat-square" alt="Circle CI"></a>
<a href="https://npmjs.com/package/@luxdamore/nuxt-prune-html"><img src="https://img.shields.io/badge/dependencies-up%20to%20date-brightgreen.svg?style=flat-square" alt="Dependencies"></a>
<a href="https://npmjs.com/package/@luxdamore/nuxt-prune-html"><img src="https://img.shields.io/npm/l/@luxdamore/nuxt-prune-html.svg?style=flat-square" alt="License"></a>
<a href="https://www.paypal.com/paypalme2/luxdamore"><img src="https://img.shields.io/badge/paypal-donate-black.svg?style=flat-square" alt="Donate"></a></p>
<blockquote>
<p>Nuxt module to prune html before sending it to the browser (it removes elements matching CSS selector(s)), useful for boosting performance showing a different HTML for bots by removing all the scripts with dynamic rendering.</p>
</blockquote>
<h2>&#x1F498; Motivation</h2>
<p>Due to the versatility of Nuxt (and of the SSR in general), a website generated (or served) via node, has everything it needs already injected (in the HTML, ex. styles).
So, usually, for a bot or for a human, the website its almost visually the same without Javascript.</p>
<p>These library was born to remove the scripts injected in the HTML only if a visitor is a <strong>Bot</strong> or a &quot;<strong>Chrome Lighthouse</strong>&quot;. This should <strong>speed up</strong> (<strong>blazing fast</strong>) your <em>nuxt-website</em> up to a value of <strong>~95</strong> in <strong>performance</strong> during an <em>Audit</em> because it <a href="https://web.dev/lighthouse-performance/">cheats various scenarios</a>.</p>
<blockquote>
<p>Obviously this could cause some unexpected behaviors.</p>
</blockquote>
<h3>Pro et contra</h3>
<p><strong><em>N.B. : Valid for Bots, PageSpeed Insights, Google Measure and Lighthouse Audits. This is known as <a href="https://developers.google.com/search/docs/guides/dynamic-rendering">Dynamic Rendering</a></em></strong></p>
<p><strong>Cons:</strong></p>
<ul>
<li>no SPA navigation;</li>
<li>no lazy-load for images (only if <a href="https://web.dev/native-lazy-loading/">native</a>, or with a custom <code>script</code> or with <code>selectorToKeep</code> );</li>
<li>no <code>&lt;client-only&gt;</code> <a href="https://nuxtjs.org/api/components-client-only/">html</a>.</li>
</ul>
<p><strong>Pro:</strong></p>
<ul>
<li>some of these features aren&apos;t &quot;used by&quot; a Bot or a Lighthouse Audit, so you don&apos;t really need them (ex. Bots doesn&apos;t need <code>SPA navigation</code>, <code>client-only</code> tags could lead in a slower TTI);</li>
<li>less HTML;</li>
<li>BOTS only have the Javascript they need;</li>
<li><a href="https://developers.google.com/speed/pagespeed/insights/">PageSpeed Insights</a>, <a href="https://web.dev/measure/">Measure</a> and <a href="https://developers.google.com/web/tools/lighthouse">Lighthouse Audit in Chrome</a> are already triggered by the plugin without the needing of change any value;</li>
<li>fast TTI, fast FCP, fast FMP, <em>fast all</em>.</li>
</ul>
<p>Inspired by this <a href="https://github.com/nuxt/rfcs/issues/22">rcfs</a> and this <a href="https://github.com/nuxt/nuxt.js/issues/2822">issue</a>.</p>
<hr>
<h3>Advices</h3>
<ul>
<li>Before setting up the module, try to <a href="https://developers.google.com/web/tools/chrome-devtools/javascript/disable">Disable JavaScript With Chrome DevTools</a> while navigate your website, <strong>this is how your website appear to a Bot (with this module activated)</strong>;</li>
<li>If you <code>generate</code> your site it&apos;s not possibile to check the <em>user-agent</em>, so i choose to always prune HTML (you can disable this behavior by setting the <code>hookGeneratePage</code> configuration value to <code>false</code>);</li>
<li>If you use some <code>&lt;client-only&gt;</code> components, you should prepare a version that is visually the same with the <a href="https://nuxtjs.org/api/components-client-only/">placeholder slot</a>;</li>
<li>This plugin was thought for Bots and uses only the <code>remove()</code> method of <code>Cheerio</code>;</li>
<li>You can check the website as a GoogleBot, following <a href="https://developers.google.com/web/tools/chrome-devtools/device-mode/override-user-agent">this guide</a>.</li>
</ul>
<h3>Related things you should know</h3>
<ul>
<li>It use the <a href="http://hgoebl.github.io/mobile-detect.js/">MobileDetect</a> library to check if <code>.is( &apos;bot&apos; )</code>, <code>.match( options.lighthouseUserAgent )</code> or <code>.match( options.matchUserAgent )</code>;</li>
<li>Nuxt <a href="https://nuxtjs.org/api/configuration-hooks/">hooks</a>, so the plugin has access to <code>req.headers[ &apos;user-agent&apos; ]</code> only if the project is <strong>running as a server</strong> (ex. <code>nuxt start</code>);</li>
<li>It use <a href="https://github.com/cheeriojs/cheerio">Cheerio</a>, <em>jQuery for servers</em>, library to prune the html.</li>
</ul>
<hr>
<h4>&#x1F4A1; Lighthouse</h4>
<p><img src="./lighthouse/before.jpg" alt="Lighthouse Audit before">
<img src="./lighthouse/after.jpg" alt="Lighthouse Audit after"></p>
<hr>
<h2>Setup</h2>
<ol>
<li>Add <code>@luxdamore/nuxt-prune-html</code> dependency to your project;</li>
<li>Add <code>@luxdamore/nuxt-prune-html</code> in the <code>modules</code> section of your <code>nuxt.config.js</code>;</li>
</ol>
<pre><code class="language-bash">
    yarn add @luxdamore/nuxt-prune-html <span class="hljs-comment"># or npm install --save @luxdamore/nuxt-prune-html</span>

</code></pre>
<h2>Configuration</h2>
<p><strong><em>N.B. : the config is only shallow merged, not deep merged.</em></strong></p>
<pre><code class="language-js">
    <span class="hljs-comment">// nuxt.config.js</span>
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {

        <span class="hljs-comment">// Module installation</span>
        <span class="hljs-attr">modules</span>: [ <span class="hljs-string">&apos;@luxdamore/nuxt-prune-html&apos;</span> ],

        <span class="hljs-comment">// Module config</span>
        <span class="hljs-attr">pruneHtml</span>: {
            <span class="hljs-attr">hideErrorsInConsole</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">hideGenericMessagesInConsole</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// Disabled in production</span>
            <span class="hljs-attr">enabled</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// Disabled in dev-mode due to the hot reload (is client-side)</span>
            <span class="hljs-attr">selectors</span>: [ <span class="hljs-comment">// Css selectors to prune</span>
                <span class="hljs-string">&apos;link[rel=&quot;preload&quot;][as=&quot;script&quot;]&apos;</span>,
                <span class="hljs-string">&apos;script:not([type=&quot;application/ld+json&quot;])&apos;</span>,
            ],
            <span class="hljs-attr">selectorToKeep</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// Disallow pruning of scripts with this class, N.B.: this selector will be appended to every selectors, `ex. script:not([type=&quot;application/ld+json&quot;]):not(__VALUE__)`</span>
            <span class="hljs-attr">script</span>: [], <span class="hljs-comment">// Inject custom scripts only for matched UA (BOTS-only)</span>
            <span class="hljs-attr">link</span>: [], <span class="hljs-comment">// Inject custom links only for matched UA (BOTS-only)</span>
            <span class="hljs-attr">cheerio</span>: { <span class="hljs-comment">// It use Cheerio under the hood, so this is the config passed in the cheerio.load() method</span>
                <span class="hljs-attr">xmlMode</span>: <span class="hljs-literal">false</span>,
            },
            <span class="hljs-attr">ignoreBotOrLighthouse</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// Remove selectors in any case, not depending on Bot or Lighthouse</span>
            <span class="hljs-attr">isBot</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// Remove selectors if is a bot</span>
            <span class="hljs-attr">isLighthouse</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// Remove selectors if match the Lighthouse UserAgent</span>
            <span class="hljs-attr">matchUserAgent</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// Remove selectors if this userAgent is matched, either as String or RegExp (a string will be converted to a case-insensitive RegExp in the MobileDetect library)</span>
            <span class="hljs-attr">hookRenderRoute</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// Activate the prune during the `hook:render:route`</span>
            <span class="hljs-attr">hookGeneratePage</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// Activate the prune during the `hook:generate:page`</span>
            <span class="hljs-attr">lighthouseUserAgent</span>: <span class="hljs-string">&apos;lighthouse&apos;</span>, <span class="hljs-comment">// Value of the Lighthouse UserAgent, either as String or RegExp (a string will be converted to a case-insensitive RegExp in the MobileDetect library)</span>
            <span class="hljs-attr">headerOverrideName</span>: <span class="hljs-string">&apos;user-agent&apos;</span>, <span class="hljs-comment">// Value of a custom header name passed from a Lambda Edge function, or similar</span>
        },

    };

</code></pre>
<p>With <code>link</code> and <code>script</code> it&apos;s possibile to add one or more objects ex.:</p>
<pre><code class="language-javascript">
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
        <span class="hljs-attr">pruneHtml</span>: {
            <span class="hljs-attr">script</span>: [
                {
                    <span class="hljs-attr">src</span>: <span class="hljs-string">&apos;/my-custom-lazy-load-for-bots.js&apos;</span>,
                    <span class="hljs-attr">lazy</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">defer</span>: <span class="hljs-literal">true</span>,
                },
            ],
            <span class="hljs-attr">link</span>: [
                {
                    <span class="hljs-attr">src</span>: <span class="hljs-string">&apos;/my-custom-lazy-load-for-bots.js&apos;</span>,
                    <span class="hljs-attr">rel</span>: <span class="hljs-string">&apos;preload&apos;</span>,
                    <span class="hljs-attr">as</span>: <span class="hljs-string">&apos;script&apos;</span>,
                    <span class="hljs-attr">position</span>: <span class="hljs-string">&apos;phead&apos;</span>, <span class="hljs-comment">// Default value is &apos;body&apos; -&gt;Other allowed values are: &apos;phead&apos;, &apos;head&apos; and &apos;pbody&apos;</span>
                },
            ],
        },
    };

</code></pre>
<hr>
<h2>Development</h2>
<ol>
<li>Clone this repository;</li>
<li>Install dependencies using <code>yarn install</code> or <code>npm install</code>;</li>
<li>Start development server using <code>yarn dev</code> or <code>npm run dev</code>.</li>
</ol>
<h2>&#x1F41E; Issues</h2>
<p>Please make sure to read the <a href="/.github/ISSUE_TEMPLATE/bug_report.md">Issue Reporting Checklist</a> before opening an issue. Issues not conforming to the guidelines may be closed immediately.</p>
<h2>&#x1F465; Contribution</h2>
<p>Please make sure to read the <a href="/.github/ISSUE_TEMPLATE/feature_request.md">Contributing Guide</a> before making a pull request.</p>
<h2>&#x1F4D6; Changelog</h2>
<p>Details changes for each release are documented in the <a href="./CHANGELOG.md"><strong>release notes</strong></a>.</p>
<h3>&#x1F4C3; License</h3>
<p><a href="./LICENSE">MIT License</a> // Copyright (&#xA9;) 2019-present <a href="https://lucaiaconelli.it">Luca Iaconelli</a></p>
<h4>&#x1F4B8; Are you feeling generous today?  :)</h4>
<p>Do you want to share a beer? We can be good friends..
<strong><a href="https://www.paypal.me/luxdamore">Paypal</a> // <a href="https://www.patreon.com/luxdamore">Patreon</a></strong></p>
<blockquote>
<p><em>It&apos;s always a good day to be magnanimous - cit</em></p>
</blockquote>
<h4>&#x1F4BC; Hire me</h4>
<p><a href="https://lucaiaconelli.it"><img src="https://img.shields.io/badge/email-Contact%20me-success" alt="Contacts"></a></p>
<p><a href="https://ko-fi.com/luxdamore"><img src="https://www.ko-fi.com/img/githubbutton_sm.svg" alt="ko-fi"></a></p>
</section>
</article></main></div></div>


</body></html>
